define("compUtils/core/compFactory",["react","create-react-class","lodash","utils"],function(e,t,r,i){"use strict";var o={},s={},n=void 0,p={},a={},c={};return i.sessionFreezer.freeze(o),i.sessionFreezer.freeze(s),{getCompClass:function(u,d){return function(u){var d=p[u];if(!d){var h=r.get(o,[u,"def"]);if(!h)return void i.log.error("Component not implemented:",u);var m=t({displayName:h.displayName||u||"componentClass",mixins:s[u].concat([h])});if(c[u]=m,d=e.createFactory(m),a[u]=d,r.get(o,[u,"isAPIComp"])){var l=n(u,m);p[u]=e.createFactory(l)}else p[u]=d}}(u),d?a[u]:p[u]},getCompReactClass:function(e){return this.getCompClass(e),c[e]},invalidate:function(e){delete p[e]},extend:function(e,t){o.hasOwnProperty(e)?s[e]=r.union(s[e].concat(t)):i.log.error("Component can't be extended:",e)},register:function(e,t,r){return o[e]={def:t,isAPIComp:r},s[e]=[],this},registerMobxObserver:function(e){return n=e,this},keys:function(){return r.keys(o)}}}),define("compUtils/core/MagicStructure",["lodash","mobx","utils"],function(e,t,r){"use strict";function i(t,r,i,o,s,n,p){!function(t,r){e.forOwn(r,function(e,r){Object.defineProperty(t,r,{value:e,enumerable:!1})})}(this,{cachedComputedStructureValues:{},siteData:t,displayedDAL:r,pointers:i,compId:o,computedPagePointer:s,computedChildrenToRender:n,computedParentDimensions:p})}var o=e(r.constants.COMP_DATA_QUERY_KEYS).values().concat(["id","componentType","type","modes","layout","skin","styleId","originalStyleId","originCompId"]).value();return i.prototype=e.transform(o,function(e,r){Object.defineProperty(e,r,{get:function(){return function(e){if(this.cachedComputedStructureValues[e])return this.cachedComputedStructureValues[e].get();var r=t.computed(function(){var t=this.pointers.components.getComponent(this.compId,this.computedPagePointer.get());if(!t||!this.displayedDAL.isExist(t))return null;var r=this.pointers.getInnerPointer(t,[e]);return this.displayedDAL.getStructureProperty(r)},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_"+e});return this.cachedComputedStructureValues[e]=r,r.get()}.call(this,r)}})},{}),Object.defineProperty(i.prototype,"components",{get:function(){if(this.cachedComputedStructureValues.components)return this.cachedComputedStructureValues.components.get();var r=t.computed(function(){return e.map(this.computedChildrenToRender.get(),"id")},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_components"});return this.cachedComputedStructureValues.components=r,r.get()}}),Object.defineProperty(i.prototype,"dimensions",{get:function(){if(this.cachedComputedStructureValues.dimensions)return this.cachedComputedStructureValues.dimensions.get();var e=t.computed(function(){return r.positionAndSize.isVerbsLayout(this.layout)?r.positionAndSize.getVerbsPositionAndSize(this.layout,this.computedParentDimensions.get(),this.siteData.getScreenSize(),this.siteData.getSiteWidth()):r.positionAndSize.getAbsolutePositionAndSize(this.layout)},{context:this,compareStructural:!0,name:this.compId+"_MagicStructure_dimensions"});return this.cachedComputedStructureValues.dimensions=e,e.get()}}),i}),define("compUtils/core/mobxObserverWrapper",["santaComponents","lodash","zepto","react-dom-factories","prop-types","create-react-class","reactDOM","mobx","mobx-react","utils","coreUtils","compUtils/core/compFactory","compUtils/core/MagicStructure","santaProps"],function(e,t,r,i,o,s,n,p,a,c,u,d,h,m){"use strict";function l(e){return{fetchSantaType:m.fetchers.fetch,siteData:e.getSiteData(),siteAPI:e}}function g(e,r,i,o){var s=t.isUndefined(r)?"masterPage":r;return{structure:i,rootNavigationInfo:e.getSiteData().getExistingRootNavigationInfo(s),rootId:s,id:o}}function f(e,r,i,o){var s=function(e,t,r,i){var o=l(e),s=g(e,t,r,i);return A.getInstance(o,s).getComputedProps(s).get()}(e.mobxObserverWrapperProps.siteAPI,e.rootId,o,e.id);return function(e){return"SITE_PAGES"===e}(e.id)&&t.assign(s,e.mobxObserverWrapperProps.propsForSitePages),s.isAffectedByModeChanges=r,i&&(s.className=(s.className||"")+" transitioning-comp"),s}function P(e){return!t.isEmpty(e)}function v(e,r,i){var o=t.map(i,function(i){return!!e||function(e,r){var i=[],o=t.get(e,"modes.definitions");if(o&&o.length){var s=t.map(o,"modeId"),n=t.keys(r);i=t.intersection(n,s)}return!t.isEmpty(i)}(i,r)});return t.zipObject(t.map(i,"id"),o)}function y(){var e=this.props.mobxObserverWrapperProps.viewerPrivateServices.displayedDAL,r=this.props.mobxObserverWrapperProps.viewerPrivateServices.pointers,i=this.props.mobxObserverWrapperProps.siteAPI.getSiteData();this.pagePointer=this.props.pagePointer||p.computed(function(){var e=i.getViewMode();return r.components.getPage(this.props.rootId,e)||r.components.getMasterPage(e)},{context:this,compareStructural:!0,name:"pagePointer_"+this.props.id}),this.childrenPointers=p.computed(function(){var t=r.components.getComponent(this.props.id,this.pagePointer.get());return function(e,t,r){var i=e&&t.components.getChildrenContainer(e);i&&r.get(i)}(t,r,e),t?r.components.getChildren(t):[]},{context:this,compareStructural:!0,name:"childrenPointers_"+this.props.id}),this.isPageStub=this.props.isPageStub||p.computed(function(){return!function(e,t){var r=e.getRootIdsWhichShouldBeRendered();return u.componentUtils.shouldBeRendered(r,t)}(this.props.mobxObserverWrapperProps.siteAPI,this.props.rootId)},{context:this,name:"isPageStub_"+this.props.id}),this.computedChildrenToRender=p.computed(function(){var i=this.childrenPointers.get();return this.isPageStub.get()&&(i=t.filter(this.childrenPointers.get(),function(e,r,i,o){return t.some([o].concat(i.components.getChildrenRecursively(o)),function(o){var s=r.get(i.getInnerPointer(o,["componentType"]));return t.includes(e.COMPONENTS_TO_KEEP_IN_STUB,s)})}.bind(this,this.props.mobxObserverWrapperProps.siteAPI,e,r))),function(e,r,i){return t.map(e,function(e){return{id:r.get(i.getInnerPointer(e,["id"])),componentType:r.get(i.getInnerPointer(e,["componentType"]))}})}(i,e,r)},{context:this,compareStructural:!0,name:"computedChildrenToRender_"+this.props.id}),this.magicStructure=new h(i,e,r,this.props.id,this.pagePointer,this.computedChildrenToRender,this.props.computedParentDimensions),this.computedDimensions=p.computed(function(){return this.magicStructure.dimensions},{name:"computedDimensions_"+this.props.id,context:this}),this.shouldRenderInStub=p.computed(function(){var e=this.isPageStub.get(),r=t.isEmpty(this.computedChildrenToRender.get()),i=this.magicStructure.componentType;return!e||!r||t.includes(this.props.mobxObserverWrapperProps.siteAPI.COMPONENTS_TO_KEEP_IN_STUB,i)},{context:this,name:this.props.id+"_shouldRenderInStub"}),this.compModes=p.computed(function(){var i=t.get(this.magicStructure.modes,"definitions");if(t.isEmpty(i))return{};var o=this.pagePointer.get().id,s=r.activeModes.getPageActiveModes(o),n=e.get(s);return t(n).mapValues(function(e,r){return t.some(i,{modeId:r})}).pickBy().value()},{context:this,compareStructural:!0,name:this.props.id+"_activeModes"}),this.compBehaviors=p.computed(function(){var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.magicStructure.propertyQuery,r=this.magicStructure.behaviorQuery;return I.getCompBehaviors(e,t,r,this.props.rootId,this.props.id)},{context:this,compareStructural:!0})}function C(){var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.props.mobxObserverWrapperProps.siteAPI.getPointers(),r=this.props.mobxObserverWrapperProps.siteAPI.getDisplayedDAL(),i=this.pagePointer.get(),o=t.components.getComponent(this.props.id,i);(this.props.structure||o&&r.isExist(o))&&e.registerCompBehaviours(this.props.rootId,this.props.id,this.compBehaviors.get())}function S(e,i,o,s,p){var a=e.getComponentByPageAndCompId(i,o);if(a){var c=t.clone(s),d=u.style.getPrefixedTransform(),h=function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}(d);c[h]=s[d],d!==h&&(c[d]=""),c.zIndex=function(e,r,i){var o=void 0;o=t.includes(e.getRenderRealtimeConfigItem("compsToShowOnTop"),r)?u.style.MAX_Z_INDEX:i?e.getRenderFlag("renderFixedPositionContainers")?50:49:"";return o}(e,o,p),a.hasOwnProperty("getRootStyle")&&t.assign(c,a.getRootStyle(c)),r(n.findDOMNode(a)).css(c)}}var b=c.triggerTypesConsts,A=m.computedPropsBuilder,I=m.propsBuilderUtil,O={ENTER:c.siteConstants.Animations.Modes.AnimationType.ENTER,LEAVE:c.siteConstants.Animations.Modes.AnimationType.LEAVE,TRANSITION:c.siteConstants.Animations.Modes.AnimationType.TRANSITION};return function(r,n){return a.observer(s({displayName:function(e,t){return"SantaTypeObserver("+(e.displayName||e.name||t.split(".").pop())+")"}(n,r),mixins:[u.renderDoneMixin],propTypes:{id:o.string.isRequired,structure:o.object,rootId:o.string,mobxObserverWrapperProps:o.object,applyStyleOverrides:o.bool},componentWillMount:function(){this.transitioningChildrenPrevLayout={},this.currentlyAnimatingChildren={},this.childrenAnimations={},this.renderedCompProps={},this.childrenToRender={},this.lastRenderedComp=null,this.isDomOnly=!1,y.call(this),this.prevActiveModes=null,this.disposeReactions=function(){return p.observe(this.compBehaviors,C.bind(this),{})}.call(this),this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderStart(this.props.id||this.props.structure.id);var e=this.props.mobxObserverWrapperProps.siteAPI,t=this.props.structure||this.magicStructure,r=l(e),i=g(e,this.props.rootId,t,this.props.id);this.computedPropsManager=A.getInstance(r,i,!!n.shouldLayout)},componentWillUpdate:function(){this.setComponentRenderStartIfNeeded()},componentWillReact:function(){this.props.mobxObserverWrapperProps.siteAPI.getSiteData().reacted=!0,this.setComponentRenderStartIfNeeded()},componentWillUnmount:function(){var e=this.props.mobxObserverWrapperProps.siteAPI;e.cancelReLayoutPending(this.props.id||this.props.structure.id),e.unregisterCompBehaviours(this.props.rootId,this.props.id||this.props.structure.id),t.invoke(this,"disposeReactions")},componentDidMount:function(){C.call(this),this.prevActiveModes=this.compModes.get(),u.displayedOnlyStructureUtil.isDisplayedComponent(this.props.id)&&this.props.mobxObserverWrapperProps.siteAPI.requestEnforceAnchors(),this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderEnd(this.props.id||this.props.structure.id)},getModesChanges:function(){var e=this.compModes.get();return this.prevActiveModes?c.modes.getModeChanges(this.prevActiveModes,e):{}},componentDidUpdate:function(){var e=this.props.mobxObserverWrapperProps.siteAPI,r=e.getSiteAspect("WidgetAspect").isContextReady(this.props.rootId);if(this.isDomOnly&&e.isDuringPostUpdatesOperations(this.props.id)||!r)return e.removePostUpdateOperationsRender(this.props.id),void e.cancelReLayoutPending(this.props.id);if(P(this.childrenAnimations)&&(!function(e,t,r,i,o,s){t.getSiteAspect("actionsAspect").executeAction("modeChange",b.MODE_CHANGED_INIT,{modeChanges:r,componentAnimations:i,transitioningComponentsPrevLayout:o,pageId:e,onComplete:s})}(this.props.rootId,e,this.getModesChanges(),this.childrenAnimations,this.transitioningChildrenPrevLayout,this.handleModeChangeAnimationsFinished),function(e){e.getSiteAspect("actionsAspect").executeAction("modeChange",b.MODE_CHANGED_EXECUTE)}(e),this.childrenAnimations={},this.transitioningChildrenPrevLayout={}),this.isDomOnly){this.isDomOnly=!1;var i=this.renderedCompProps.style,o=t.get(this.magicStructure,"layout.fixedPosition",!1);S(e,this.props.rootId,this.props.id,i,o),n.applyCompSpecificDomOnlyPatches&&n.applyCompSpecificDomOnlyPatches(this,i)}var s=this.props.mobxObserverWrapperProps.siteAPI.getPointers(),p=this.props.mobxObserverWrapperProps.siteAPI.getDisplayedDAL(),a=this.pagePointer.get(),c=this.computedChildrenToRender.get();this.childrenData={rotationDegrees:t.reduce(c,function(e,r){var i=r.id,o=s.components.getComponent(i,a);return t.set(e,i,p.get(s.getInnerPointer(o,"layout.rotationInDegrees")))},{})},this.prevActiveModes=this.compModes.get(),u.displayedOnlyStructureUtil.isDisplayedComponent(this.props.id)&&e.requestEnforceAnchors(),this.computedPropsManager.clearChangedPropsMap();var d=this.props.id||this.props.structure.id;this.shouldLayout&&e.setComponentRenderEnd(d)},getRenderedCompProps:function(e,r){var i=e.mobxObserverWrapperProps.siteAPI,o=this.currentlyAnimatingChildren,s=this.getModesChanges(),n=!t.isEmpty(s),p=function(e,t,r,i,o){var s=r&&!!o,n=f(i,r,i.compAnimationType===O.TRANSITION||s,e);return n.childrenSet=t,n}(e.structure||this.magicStructure,this.props.structure?[]:this.computedChildrenToRender.get(),n,e,r);if(n){var a=v(p.isAffectedByModeChanges,s,this.computedChildrenToRender.get());this.childrenAnimations=function(e,r,i){var o=t.keyBy(e.childrenSet,"id"),s=t.keyBy(r.childrenSet,"id"),n=t.reduce(s,function(e,r,i){return o[i]?e:t.set(e,i,O.ENTER)},{});return t.reduce(o,function(e,r,o){return s[o]?i[o]?t.set(e,o,O.TRANSITION):e:t.set(e,o,O.LEAVE)},n)}(r,p,a),this.transitioningChildrenPrevLayout=function(e,r,i){var o=e.getSiteData(),s=o.measureMap;if(!s)return{};var n=e.getSiteAspect("windowScrollEvent").getScrollPosition(),p=t.partial(t.isEqual,O.TRANSITION);return t(r).pickBy(p).mapValues(function(e,r){var p=s.shownInFixed[r]?s.absoluteLeft[r]-n.x:s.absoluteLeft[r]-o.getSiteX()-n.x;return{width:s.width[r],height:s.height[r],left:p,top:s.absoluteTop[r]-n.y,rotation:t.get(i,["rotationDegrees",r])}}).value()}(i,this.childrenAnimations,this.childrenData),t.assign(o,this.childrenAnimations)}return P(o)?this.childrenToRender=function(e,r,i,o){var s=t.filter(i,function(e){return!!o[e.id]});return t.unionBy(e.childrenSet,s,r.childrenSet,"id")}(r,p,this.childrenToRender,o):this.childrenToRender=p.childrenSet,t.assign(p,{pageStub:this.isPageStub.get(),ref:this.compRefFunction},this.props)},compRefFunction:function(e){this.props.mobxObserverWrapperProps.addComponentRef&&this.props.mobxObserverWrapperProps.addComponentRef(e,this.props.id)},getChildProps:function(e){return{id:e,rootId:this.props.rootId,anyChangeInParentActiveModes:!(!this.props.anyChangeInParentActiveModes&&t.isEmpty(this.getModesChanges())),computedParentDimensions:this.computedDimensions,mobxObserverWrapperProps:this.props.mobxObserverWrapperProps,pagePointer:this.pagePointer,isPageStub:this.isPageStub,key:e,refInParent:e}},setComponentRenderStartIfNeeded:function(){var e=this;this.shouldLayout=function(){var r=e.computedPropsManager.getChangedProps(),i=n.shouldLayout;if(i){if(t.isFunction(i))return i(r);if(t.isObject(i))return t.some(r,function(e,r){return t.isUndefined(i[r])||i[r]})}return!0}(),this.shouldLayout&&this.props.mobxObserverWrapperProps.siteAPI.setComponentRenderStart(this.props.id||this.props.structure.id)},render:function(){var r=this.props.mobxObserverWrapperProps.siteAPI,o=r.getSiteAspect("WidgetAspect").isContextReady(this.props.rootId);if(!this.props.structure&&!this.magicStructure.id||!this.shouldRenderInStub.get()||!o&&!this.isPageStub.get())return this.lastRenderedComp;var s=t.clone(this.renderedCompProps);if(this.renderedCompProps=this.getRenderedCompProps(this.props,s),this.isDomOnly=!r.isExperimentOpen("sv_meshLayout")&&function(e,r,i){var o=t.omitBy(r,function(r,i){return e[i]===r||t.isEqual(e[i],r)}),s=1===t.size(o)&&!!o.style&&!t.isEqual(e.style,r.style)&&r.style.display===e.style.display;return t.isFunction(i.compSpecificIsDomOnly)?s&&i.compSpecificIsDomOnly(e,r):s}(s,this.renderedCompProps,n),this.isDomOnly)return this.lastRenderedComp;var p=t.map(this.childrenToRender,function(e){return function(e){return e&&d.getCompClass(e)||i.div}(e.componentType)(this.getChildProps(e.id))}.bind(this)),a=t.omit(this.renderedCompProps,["mobxObserverWrapperProps","childrenSet","isPageStub","pagePointer"]);return this.lastRenderedComp=e.utils.createReactElement(n,a,p),this.lastRenderedComp},handleModeChangeAnimationsFinished:function(e){this.currentlyAnimatingChildren=t.omit(this.currentlyAnimatingChildren,t.keys(e)),P(this.currentlyAnimatingChildren)||this.forceUpdate()}}))}}),define("compUtils",["compUtils/core/compFactory","compUtils/core/mobxObserverWrapper"],function(e,t){"use strict";return{compFactory:e,mobxObserverWrapper:t}});
//# sourceMappingURL=compUtils.min.js.map